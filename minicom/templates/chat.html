<!DOCTYPE html>
<html>
<body>
<h2>Your Chat</h2>

<div id="messages"></div>

<input id="msg" placeholder="Type message...">
<button onclick="sendMsg()">Send</button>

<script>
// FRONTEND SESSION
const email = sessionStorage.getItem("userEmail");

// If not logged in â†’ redirect
if (!email) {
    window.location = "/login/";
}

function load() {
    fetch(`/api/messages/${email}/`)
        .then(r => r.json())
        .then(data => {
            document.getElementById("messages").innerHTML =
                data.map(m => `<p><b>${m.sender_type}:</b> ${m.content}</p>`).join("");
        });
}

function sendMsg() {
    const content = document.getElementById("msg").value;
    
    fetch(`/api/send/${email}/admin@minicom.com/`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({content})
    })
    .then(() => {
        document.getElementById("msg").value = "";
        load();
    });
}

setInterval(load, 1500);
load();
</script>

</body>
</html>
