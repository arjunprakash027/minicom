#!/bin/bash
source .venv/bin/activate

pkill -f "python3 -m http.server" 2>/dev/null
pkill -f "http.server" 2>/dev/null
pkill -f "daphne" 2>/dev/null

start_static() {
    DIR=$1
    PORT=$2
    NAME=$3

    if [ ! -d "$DIR" ]; then
        echo "Skipping $NAME â€” folder not found: $DIR"
        return
    fi

    echo "Starting $NAME server at http://127.0.0.1:$PORT ..."

    (
        cd "$DIR" && python3 -m http.server "$PORT"
    ) &

    sleep 0.2
}


start_static "./foo-website" 8008 "Foo"
start_static "./bar-website" 8009 "Bar"
echo "Starting Django backend on http://127.0.0.1:8000 ..."
exec daphne -p 8000 minicom.asgi:application
